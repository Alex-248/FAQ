.. Fedora-Faq-Ru (c) 2018 - 2019, EasyCoding Team and contributors
.. 
.. Fedora-Faq-Ru is licensed under a
.. Creative Commons Attribution-ShareAlike 4.0 International License.
.. 
.. You should have received a copy of the license along with this
.. work. If not, see <https://creativecommons.org/licenses/by-sa/4.0/>.
.. _hardware:

**************************************************************
Вопросы, связанные с использованием различного оборудования
**************************************************************

.. index:: hardware, selection
.. _linux-hardware:

На что в первую очередь следует обратить внимание при выборе ноутбука для Linux?
====================================================================================

 1. Следует обратить внимание на производителя :ref:`установленного Wi-Fi модуля <wifi-chip>`.
 2. Не рекомендуется приобретать устройства с гибридной графикой ибо технология NVIDIA Optimus в настоящее время не поддерживается под GNU/Linux официально и работает исключительно посредством Bumblebee от сторонних разработчиков, который часто работает нестабильно.
 3. Ни при каком условии не приобретать ноутбук с видеокартой :ref:`NVIDIA GeForce GTX 1050 <nvidia-gtx1050>`.
 4. Перед покупкой рекомендуется исследовать работу :ref:`свежего Fedora Live USB <download>` непосредственно на данном устройстве, а также проверить :ref:`вывод dmesg <journal-current>` на наличие ошибок ACPI.

.. index:: hardware, firmware, update
.. _fedora-fwupd:

Как обновить прошивку UEFI BIOS и других устройств непосредственно из Fedora?
==================================================================================

Для оперативного обновления микропрограмм (прошивок) существует утилита `fwupd <https://github.com/hughsie/fwupd>`__:

.. code-block:: bash

    sudo dnf install fwupd

Внимание! Для работы fwupd система должна быть установлена строго в :ref:`UEFI режиме <uefi-boot>`.

Обновление базы данных программы:

.. code-block:: bash

    fwupdmgr refresh

Вывод списка устройств, микропрограмма которых может быть обновлена:

.. code-block:: bash

    fwupdmgr get-devices

Проверка наличия обновлений с выводом подробной информации о каждом из них:

.. code-block:: bash

    fwupdmgr get-updates

Установка обнаруженных обновлений микропрограмм:

.. code-block:: bash

    fwupdmgr update

Некоторые устройства могут быть обновлены лишь при следующей загрузке системы, поэтому выполним перезагрузку:

.. code-block:: bash

    sudo systemctl reboot

.. index:: wi-fi, chipset, hardware, selection
.. _wifi-chip:

Какие модули Wi-Fi корректно работают в Linux?
===================================================

Без проблем работают Wi-Fi модули следующих производителей:

 * Qualcomm Atheros (однако ath10k требуют загрузки прошивок из комплекта поставки ядра);
 * Intel Wireless (требуют загрузки индивидуальных прошивок iwl из поставки ядра).

Работают 50/50:

 * Realtek (широко известны проблемы с чипами серий rtl8192cu и rtl8812au);
 * MediaTek (ранее назывался Ralink).

Не работают:

 * Broadcom (для их работы необходима установка :ref:`проприетарных драйверов <broadcom-drivers>`, которые часто ведут себя непредсказуемо и могут вызывать сбои в работе ядра системы).

.. index:: nvidia, gtx1050, video card
.. _nvidia-gtx1050:

В моём ноутбуке установлена видеокарта NVIDIA GeForce GTX 1050 и после запуска система зависает. Что делать?
================================================================================================================

Случайные зависания системы, неработоспособность тачпада и других USB устройств - это следствие сбоев при работе свободного драйвера nouveau на данной видеокарте.

В качестве решения необходимо установить проприетарные драйверы по такому алгоритму:

 1. произвести чистую установку систему со :ref:`свежего Fedora Live USB <download>` (respin);
 2. войти в систему, установить все обновления и, **не перезагружаясь**, выполнить установку :ref:`проприетарных драйверов <nvidia-drivers>` Optimus по **альтернативному варианту**.
 3. выполнить перезагрузку системы.

Если всё сделано верно, то система начнёт функционировать в штатном режиме. В противном случае следует повторить с самого начала.

.. index:: drivers, disable driver
.. _driver-disable:

Как можно навсегда отключить определённый драйвер устройства?
================================================================

Чтобы навсегда отключить какой-то драйвер в Linux, необходимо создать файл в каталоге ``/etc/modprobe.d`` с любым именем, например ``disable-nv.conf``, и примерно таким содержанием:

.. code-block:: text

    install nouveau /bin/false

Здесь вместо **nouveau** нужно указать реально используемые устройством драйверы.

Полный список загруженных драйверов можно получить так:

.. code-block:: bash

    lspci -nnk

Теперь необходимо пересобрать inird образ:

.. code-block:: bash

    sudo dracut --force

Чтобы отменить действие, достаточно удалить созданный файл и снова пересобрать initrd.

.. index:: wi-fi, rfkill, wireless
.. _rfkill-status:

Модуль настройки сети не отображает беспроводных устройств. Что делать?
===========================================================================

Для начала воспользуемся утилитой **rfkill** для того, чтобы определить состояние беспроводных модулей:

.. code-block:: bash

    rfkill

Статус **hard blocked** означает, что устройство отключено аппаратно и требуется включить его определённой последовательностью **Fn + Fx** (см. руководство ноутбука).

Статус **soft blocked** означает, что устройство отключено программно, например режимом *В самолёте*.

.. index:: wi-fi, rfkill, wireless
.. _rfkill-wifi:

Как программно включить или отключить беспроводной модуль Wi-Fi?
===================================================================

Снимем программную блокировку Wi-Fi и активируем модуль:

.. code-block:: bash

    rfkill unblock wlan

Установим программную блокировку Wi-Fi и отключим модуль:

.. code-block:: bash

    rfkill block wlan

.. index:: bluetooth, rfkill, wireless
.. _rfkill-bluetooth:

Как программно включить или отключить беспроводной модуль Bluetooth?
=======================================================================

Снимем программную блокировку Bluetooth и активируем модуль:

.. code-block:: bash

    rfkill unblock bluetooth

Установим программную блокировку Bluetooth и отключим модуль:

.. code-block:: bash

    rfkill block bluetooth

.. index:: lte, rfkill, wireless
.. _rfkill-lte:

Как программно включить или отключить беспроводной модуль LTE (4G)?
======================================================================

Снимем программную блокировку LTE (4G) и активируем модуль:

.. code-block:: bash

    rfkill unblock wwan

Установим программную блокировку LTE (4G) и отключим модуль:

.. code-block:: bash

    rfkill block wwan

.. index:: com, rs-232, port, screen
.. _screen-com:

Как правильно работать с COM портами (RS-232)?
==================================================

Для работы с COM портами (RS-232) можно применять следующие утилиты:

 * screen;
 * putty.

Воспользуемся утилитой **screen** для подключения к последовательному порту:

.. code-block:: bash

    screen /dev/ttyS0 115200

Здесь **/dev/ttyS0** - путь к первому COM порту в системе, а **115200** - скорость работы в бодах.

Если при подключении вместо текста отображается различный мусор, значит скорость указана не правильно и её следует либо подбирать экспериментально, либо получить из руководства.

Для завершения сессии следует нажать **Ctrl + A** и **k**.

.. index:: monitor, resolution, xorg, x11, dac, dhmi, d-sub, vga
.. _dac-ddc:

При подключении монитора через переходник отображается неправильное разрешение. Как исправить?
==================================================================================================

Большинство "переходников" из цифры в аналог (DVI-D -> D-SUB, HDMI -> D-SUB и т.д.) не передают данные с монитора о поддерживаемых им разрешениях экрана системе посредством протокола `Display Data Channel (DDC) <https://ru.wikipedia.org/wiki/Display_Data_Channel>`__, поэтому существует два решения:

 * не использовать подобные устройства (к тому же они значительно ухудшают качество изображения);
 * :ref:`прописать поддерживаемые разрешения <x11-resulutions>` самостоятельно в конфиге X11.

.. index:: monitor, resolution, xorg, x11
.. _x11-resulutions:

Как прописать список поддерживаемых монитором разрешений?
============================================================

Создадим отдельный файл конфигурации для монитора ``10-monitor.conf`` в каталоге ``/etc/X11/xorg.conf.d`` и пропишем доступные разрешения и используемый драйвер.

Сначала посредством запуска утилиты **cvt** вычислим значение строки ``Modeline`` для требуемого разрешения:

.. code-block:: bash

    cvt 1920 1080 60

Здесь **1920** - разрешение по горизонтали, **1080** - по вертикали, а **60** - частота регенерации.

Теперь создадим конфиг следующего содержания:

.. code-block:: text

    Section "Monitor"
        Identifier "VGA1"
        Modeline "1920x1080_60.00"  173.00  1920 2048 2248 2576  1080 1083 1088 1120 -hsync +vsync
        Option "PreferredMode" "1920x1080_60.00"
    EndSection

    Section "Screen"
        Identifier "Screen0"
        Monitor "VGA1"
        DefaultDepth 24
        SubSection "Display"
            Modes "1920x1080_60.00"
        EndSubSection
    EndSection

    Section "Device"
        Identifier "Device0"
        Driver "intel"
    EndSection

Вместо **intel** укажем реально используемый драйвер видеокарты. Изменения вступят в силу при следующей загрузке системы.

.. index:: benchmark, cpu, system
.. _benchmark-cpu:

Какой бенчмарк можно использовать для оценки производительности системы?
===========================================================================

В качестве CPU бенчмарка рекомендуется использовать `sysbench <https://github.com/akopytov/sysbench#usage>`__, либо `stress-ng <https://kernel.ubuntu.com/~cking/stress-ng/>`__:

Установим sysbench:

.. code-block:: bash

    sudo dnf install sysbench

Установим stress-ng:

.. code-block:: bash

    sudo dnf install stress-ng

.. index:: benchmark, video card, gpu, glxgears, glmark2, unigine
.. _benchmark-gpu:

Какой бенчмарк можно использовать для оценки производительности видеокарты?
==============================================================================

В настоящее время существует несколько бенчмарков:

Glxgears
^^^^^^^^^^^

Установка:

.. code-block:: bash

    sudo dnf install glx-utils

Запуск:

.. code-block:: bash

    glxgears

Выводит информацию о кадровой частоте в терминал каждые 5 секунд.

GL Mark 2
^^^^^^^^^^^^

Установка:

.. code-block:: bash

    sudo dnf install glmark2

Запуск:

.. code-block:: bash

    glmark2

Выводит информацию о кадровой частоте и финальный результат в терминал.

Unigine Benchmark
^^^^^^^^^^^^^^^^^^^^^

Установка:

.. code-block:: bash

    wget https://assets.unigine.com/d/Unigine_Superposition-1.0.run
    chmod +x Unigine_Superposition-1.0.run
    ./Unigine_Superposition-1.0.run

Запускать бенчмарк следует при помощи созданного ярлыка в меню приложений.

.. index:: firmware, linux, kernel, device
.. _linux-firmware:

Что такое firmware и для чего она необходима?
================================================

Firmware - это бинарный проприетарный блоб, содержащий образ прошивки, который загружается и используется определённым устройством.

В большинстве случаев, соответствующее устройство не будет функционировать без наличия данной прошивки в каталоге прошивок ядра Linux.

.. index:: firmware, linux, kernel, device
.. _firmware-install:

Где взять бинарные прошивки для устройств и как их установить?
=================================================================

:ref:`Бинарные прошивки <linux-firmware>` для большей части устройств уже находятся в пакете **linux-firmware**, но некоторые (например часть принтеров HP), загружают их самостоятельно, либо поставляют внутри отдельных firmware-пакетов.

.. index:: firmware, linux, kernel, device
.. _firmware-status:

Как проверить используются ли в моём устройстве бинарные прошивки?
=====================================================================

При загрузке :ref:`бинарных прошивок <linux-firmware>` ядро обязательно сохраняет информацию об этом в :ref:`системный журнал <journal-current>`, поэтому достаточно лишь отфильтровать его по ключевому слову *firmware*:

.. code-block:: bash

    journalctl -b | grep firmware
