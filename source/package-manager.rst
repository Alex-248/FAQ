.. _package-manager:

***************************************************************
Вопросы, связанные с пакетным менеджером и установкой пакетов
***************************************************************

.. index:: package, manager, менеджер пакетов
.. _pkg-manager:

Какой менеджер пакетов используется в настоящее время?
==========================================================

Dnf, являющийся, в свою очередь, форком Yum.

.. index:: package, manager, менеджер пакетов
.. _yum-fedora:

Могу ли я использовать Yum в Fedora?
=========================================

Начиная с Fedora 24 yum присутствует в Fedora лишь как символическая ссылка на dnf, сохранённая для обратной совместимости.

.. index:: installation, packaging, make install
.. _make-install:

Можно ли устанавливать программы посредством make install?
================================================================

Категорически не рекомендуется ибо:

 1. make install порождает в системе кучу никем и ничем не отслеживаемых файлов: бинарников, конфигов, прочих файлов. Это в большинстве случаев приведёт к множеству проблем при обновлении или удалении;
 2. make install не учитывает файлы других пакетов и может запросто перезаписать или удалить в системе что-то важное, т.к. действие выполняется с правами суперпользователя;
 3. make install не ведёт никакого журнала действий, поэтому всё, что оно произвело, невозможно полноценно откатить;
 4. установленные через make install приложения очень часто невозможно удалить вообще, т.к. многие разработчики не делают правило make uninstall, что, в принципе, верно ибо оно не нужно большинству, а если и делают, то оно способно лишь удалить скопированные файлы. Изменения конфигов, других файлов и пр. откатить оно не способно.

Установка пакетов штатным пакетным менеджеров имеет множество преимуществ:

 1. при установке пакетный менеджер разрешает все зависимости, добавляет нужные, устраняет конфликты;
 2. перед выполнением установки пакетный менеджер проверяет, чтобы устанавливаемый пакет не вмешивался в работу других, а также самой системы. Если это так, он не будет установлен;
 3. во время установки все изменения, сделанные пакетом, вносятся в специальную базу данных пакетного менеджера и при удалении или обновлении будут учтены;
 4. при удалении пакета производится полный откат действий, предпринятых при установке (даже если были изменены какие-то конфиги, эти действия будут откачены полностью, т.к. хранится diff внутри базы ПМ);
 5. при обновлении перезаписываются только изменённые файлы. Более того, может быть скачан и установлен только дифф. изменений;
 6. если при обновлении пакета возникает конфликт какого-то конфига, он не будет молча перезаписан, а будет применён патч на существующий, либо, если это невозможно, будет запрошено действие у пользователя.

.. index:: DM change, смена менеджера сеансов, менеджер сеансов
.. _change-dm:

У меня в системе используется GDM, но я хочу заменить его на SDDM. Это возможно?
==================================================================================

Установка SDDM:

.. code-block:: bash

    sudo dnf install sddm

Отключение GDM и активация SDDM:

.. code-block:: bash

    sudo systemctl disable gdm
    sudo systemctl enable sddm

Изменения вступят в силу при следующей загрузке системы.

.. index:: fedora, upgrade
.. _dist-upgrade:

Как мне обновить Fedora до новой версии?
===========================================

Процесс обновления стандартен и максимально безопасен:

.. code-block:: bash

    sudo dnf upgrade --refresh
    sudo dnf install dnf-plugin-system-upgrade
    sudo dnf system-upgrade download --releasever=29
    sudo dnf system-upgrade reboot

Здесь **29** - номер версии, на которую нужно обновиться. Весь процесс установки будет выполнен во время следующей загрузки системы.

Если произошёл какой-то конфликт, то рекомендуется очистить все кэши dnf:

.. code-block:: bash

    sudo dnf clean all

.. index:: dnf, package error, ошибка обновления
.. _dnf-duplicates:

При обновлении dnf ругается на дубликаты пакетов.
===================================================

Удалить дубликаты и повреждённые пакеты можно так:

.. code-block:: bash

    sudo package-cleanup --cleandupes --noscripts

.. index:: dnf, ошибка обновления, повреждение базы RPM
.. _dnf-rpmdb:

База RPM оказалась повреждена. Как восстановить?
=====================================================

Для запуска пересборки базы данных RPM следует выполнить:

.. code-block:: bash

    sudo rpm --rebuilddb

Настоятельно рекомендуется сделать резервную копию каталога **/var/lib/rpm** перед этим действием.

.. index:: dnf, kernel count, сохранение ядер Linux
.. _dnf-kernel-store:

Dnf сохраняет старые ядра. Это нормально?
==============================================

Да. По умолчанию dnf сохраняет 3 последних ядра, чтобы в случае сбоя была возможность загрузки в более старое и исправления работы системы.

.. index:: dnf, kernel count, сохранение ядер Linux
.. _dnf-kernel-change:

Как можно уменьшить количество сохраняемых ядер?
====================================================

Необходимо открыть файл **/etc/dnf/dnf.conf** в любом текстовом редакторе и изменить значение переменной **installonly_limit**:

.. code-block:: text

    installonly_limit=2

Минимально допустимое значение - **2** (будут сохраняться два ядра: текущее и предыдущее).

.. index:: dnf, proxy, прокси
.. _dnf-proxy:

Как настроить работу dnf через прокси?
=========================================

Необходимо открыть файл **/etc/dnf/dnf.conf** в любом текстовом редакторе и изменить значение переменной **proxy** (при отсутствии добавить):

.. code-block:: text

    proxy=socks5://localhost:8080

Поддерживаются HTTP, HTTPS и SOCKS.

.. index:: dnf, weak dependencies, слабые зависимости
.. _dnf-weakdeps:

Как отключить установку слабых зависимостей?
================================================

Необходимо открыть файл **/etc/dnf/dnf.conf** в любом текстовом редакторе и изменить значение переменной **install_weak_deps** (при отсутствии добавить):

.. code-block:: text

    install_weak_deps=0

.. index:: dnf, disable package updates, запрет обновлений пакетов
.. _dnf-pkgupdates:

Как мне запретить установку обновлений для ряда пакетов?
============================================================

Необходимо открыть файл **/etc/dnf/dnf.conf** в любом текстовом редакторе и изменить значение переменной **exclude** (при отсутствии добавить):

.. code-block:: text

    exclude=kernel* PackageKit*

Здесь вместо примера следует указать нужные пакеты, разделяя их пробелом. Допускаются символы подстановки.

.. index:: dnf, remove kernel, удаление ядра
.. _dnf-kernel-remove:

Как можно вручную удалить старое ядро?
==========================================

Для ручного удаления старого ядра можно выполнить:

.. code-block:: bash

    sudo dnf remove kernel-4.10.14* kernel-core-4.10.14* kernel-modules-4.10.14* kernel-devel-4.10.14*

Здесь **4.10.14** - это версия удаляемого ядра.
